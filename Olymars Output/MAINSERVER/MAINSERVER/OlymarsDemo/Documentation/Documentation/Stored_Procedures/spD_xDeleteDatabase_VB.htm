<html>
	<head>
		<meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
		<title>
			spD_xDeleteDatabase - Calling this stored procedure using Visual Basic .NET
		</title>
		<link href="../StyleSheet.css" type="text/css" rel="stylesheet">
	</head>
	<body>
		<div class="FirstLevelTitle">
			spD_xDeleteDatabase
		</div>
		<div class="FirstLevelSubTitle">
			&nbsp;&nbsp;&nbsp;Calling this stored procedure using Visual Basic .NET
		</div>
		<hr>
		<div class="MainTitle">
			Overview
		</div>
		<blockquote>
				<div class="MainBody">
					You will find next a sample of code written in Visual Basic .NET that will
					allows you to call the classes responsible for executing the stored procedure
					[spD_xDeleteDatabase].
				</div>
				<br>
				<div class="MainBody">
					This stored procedure was automatically generated
						This stored procedure allows you to delete all the tables content.
						The deletion is done in the <b>correct order</b> so that no error
						can be thrown.
				<br>
				<br>
			To read an overview on this stored procedure, click <a href="spD_xDeleteDatabase_Overview.htm">here</a>.<br>
			To see an example on how to call this class in Visual C# .NET, click <a href="spD_xDeleteDatabase_CS.htm">here</a>.<br>
				</div>
				<br>
			</blockquote>
			<hr>
			<div class="MainTitle">
				The basics
			</div>
			<blockquote>
				<div class="MainBody">
					Basically, the concept of thoses classes is the following:
					<UL>
						<LI>
							<div class="FixedMainTitle">
								<b>OlymarsDemo.DataClasses.Parameters.spD_xDeleteDatabase</b>: 
							</div>
							<div class="FixedMainBody">
								this class is responsible for taking the stored procedure parameters value and will let
								you retrieve the output parameters (including the Return Value) once the call to the stored
								procedure has been made;
							</div>
							<br>
						</LI>
						<LI>
							<div class="FixedMainTitle">
								<b>OlymarsDemo.DataClasses.StoredProcedures.spD_xDeleteDatabase</b>: 
							</div>
							<div class="FixedMainBody">
								this class is responsible for executing the stored procedure itself.
							</div>
						</LI>
					</UL>
				</div>
				<br>
				<div class="MainBody">
					In order to execute this stored procedure, we need to execute the four following steps:
					<UL>
						<LI>
							Make a reference to the correct assembly (from Visual Studio.NET or from the compiler command line);
						</LI>
						<LI>
							Add some directives so that the code is more easy to read;
						</LI>
						<LI>
							Use the "Parameter" class;
						</LI>
						<LI>
							Execute the "Stored Procedure" class and then retrieve back some data (if available);
						</LI>
					<UL>
				</div>
				<br>
			</blockquote>
			<hr>
			<div class="MainTitle">
				Step by step tutorial
			</div>
			<blockquote>
				<div class="MainTitle">
					First Step:
				</div>
				<blockquote>
					<div class="MainBody">
						If you are in Visual Studio.NET, make a reference to the following
						assembly: "OlymarsDemo.dll".
					</div>
					<br>
					<div class="MainBody">
						If you are using the compiler, be sure to add a "/r:" switch pointing
						on the following assembly: "OlymarsDemo.dll".
					</div>
				</blockquote>
				<div class="MainTitle">
					Second Step:
				</div>
				<blockquote>
					<div class="MainBody">
						add thoses directives at the top of your code:
					</div>
					<div class="Code">
						Imports System.Data.SqlClient<br>
						Imports OlymarsDemo.DataClasses<br>
						Imports Params = OlymarsDemo.DataClasses.Parameters<br>
						Imports SPs = OlymarsDemo.DataClasses.StoredProcedures<br>
					</div>
				</blockquote>
				<div class="MainTitle">
					Third Step:
				</div>
				<blockquote>
					<div class="MainBody">
						We are going now to initialize the "Parameter" class:
					</div>
					<br>
					<div class="Comment">
						' Let's instanciate the correct parameter object for this stored<br>
						' procedure.<br>
						'<br>
						' By using True in the constructor, we indicate to the class<br>
						' that if we do NOT supply values for some of the stored procedure<br>
						' parameters, it means that it should use the stored procedure<br>
						' parameters default values instead.
					</div>
					<div class="Code">
						Dim Param As New Params.spD_xDeleteDatabase(True)
					</div>
					<br>
					<a name="Connection"></a>
					<div class="Comment">
						' Let's define on which server and database we want to<br>
						' execute this stored procedure.<br>
						'<br>
						' A helper function is available to you if you need to build<br>
						' a valid connection string.<br>
						' If a blank connection string is supplied, the class will search for:<br>
						'<br>
						' &nbsp;&nbsp;First an entry in the configuration file:<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;appSettings&gt;<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;add key="OlymarsDemo ConnectionString" value="..." /&gt;<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/appSettings&gt;<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br>
						'<br>
						' &nbsp;&nbsp;Then the following registry entry:<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;-Key: HKEY_LOCAL_MACHINE\SOFTWARE\ConnectionStrings\OlymarsDemo<br>
						' &nbsp;&nbsp;&nbsp;&nbsp;-String Value: ConnectionString
						' <br>
						' To see the documentation on how to build this connection string,<br>
						' <a href="ms-help://MS.NETFrameworkSDKv1.1/cpref/html/frlrfSystemDataSqlClientSqlConnectionClassConnectionStringTopic.htm">click here</a><br>
						'<br>
						' You can also supply a valid SqlConnection or<br>
						' a valid SqlTransaction object.
					</div>
					<div class="Code">
						<br>
						<div class="FixedComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' First case: you can supply a connection string</div>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim ConnectionString As String = Information.BuildConnectionString("MAINSERVER\MAINSERVER", "OlymarsDemo")<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Param.SetUpConnection(ConnectionString)<br>
						<br>
						<div class="FixedComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Second case: you can supply a valid <a href="ms-help://MS.NETFrameworkSDKv1.1/cpref/html/frlrfsystemdatasqlclientsqlconnectionclasstopic.htm">SqlConnection</a> object</div>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim sqlConnection As New SqlConnection(ConnectionString)<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sqlConnection.Open()<br>
						<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Param.SetUpConnection(sqlConnection)<br>
						<br>
						<div class="FixedComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Third case: you can supply a valid <a href="ms-help://MS.NETFrameworkSDKv1.1/cpref/html/frlrfSystemDataSqlClientSqlTransactionClassTopic.htm">SqlTransaction</a> object</div>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim sqlConnection As New SqlConnection(ConnectionString)<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sqlConnection.Open()<br>
						<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dim sqlTransaction As SqlTransaction = sqlConnection.BeginTransaction()<br>
						<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Param.SetUpConnection(sqlTransaction)<br>
						<div class="FixedComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Note: you can call sqlTransaction.Commit()<br>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' or sqlTransaction.Rollback() after the call.</div>
					</div>
					<br>
					<div class="Comment">
						' You can specify a command time-out. The default value is 15 seconds.
					</div>
					<div class="Code">
						Param.CommandTimeOut = 60
					</div>
					<br>
					<div class="Comment">
						' We can now set some or all the stored procedure parameters.<br>
						' If a parameter is not set, it will be consider as Null when<br>
						' supplied to the stored procedure.
					</div>
					<br>
				</blockquote>
				<div class="MainTitle">
					Last Step:
				</div>
				<blockquote>
					<div class="MainBody">
						Now let's execute the stored procedure itself
						and retrieve back the ReturnValue/Output parameters:
					</div>
					<br>
					<div class="Comment">
						' Let's now instanciate the corresponding stored procedure object.<br>
						<br>
						' <b>False</b> means that we do not want the Execute method to throw any<br>
						' exception but instead we want to get a boolean return status.
					</div>
					<div class="Code">
						Dim SP As New SPs.spD_xDeleteDatabase(False)
					</div>
					<br>
					<div class="Comment">
						' We can now execute the stored procedure.
					</div>
					<div class="Code">
						If SP.Execute(Param) Then<br>
						<br>
							<div class="FixedComment">
								&nbsp;&nbsp;&nbsp;&nbsp;' We can now retrieve the RETURN_VALUE<br>
								&nbsp;&nbsp;&nbsp;&nbsp;' and all the Input/Output parameters.
							</div>
							&nbsp;&nbsp;&nbsp;&nbsp;If Not(Param.Param_RETURN_VALUE.IsNull) Then<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... = Param.Param_RETURN_VALUE.Value<br>
							&nbsp;&nbsp;&nbsp;&nbsp;End If<br>
							<br>
						<br>
						Else
						<br>
							<div class="FixedComment">
								&nbsp;&nbsp;&nbsp;&nbsp;' At this level, an exception has occured. Every "Parameter"<br>
								&nbsp;&nbsp;&nbsp;&nbsp;' object implements the same interface which is IParameter.<br>
								&nbsp;&nbsp;&nbsp;&nbsp;' We can get back this interface and find out exactly what<br>
								&nbsp;&nbsp;&nbsp;&nbsp;' kind of error has occured and at what level of the<br>
								&nbsp;&nbsp;&nbsp;&nbsp;' process this exception occured.<br>
							</div>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;Dim ParameterInfo As IParameter = Param<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;Select Case ParameterInfo.ErrorSource<br>
							&nbsp;&nbsp;&nbsp;&nbsp;<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.ConnectionInitialization<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.SqlException.ToString())<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.ParametersSetting<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.SqlException.ToString())<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.ConnectionOpening<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.SqlException.ToString())<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.QueryExecution<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.SqlException.ToString())<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.ParametersRetrieval<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.SqlException.ToString())<br>
							<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case ErrorSource.Other<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ParameterInfo.OtherException.ToString())<br>
							&nbsp;&nbsp;&nbsp;&nbsp;<br>
							&nbsp;&nbsp;&nbsp;&nbsp;End Select
							&nbsp;&nbsp;&nbsp;&nbsp;<br>
						<br>
						End If<br>
						<br>
						<div class="FixedComment">
							' Now, we can dispose our objects.
						</div>
						Param.Dispose()<br>
						SP.Dispose()<br>
					</div>
				</blockquote>
		</blockquote>
		<hr>
		<div class="Copyright">
			This documentation was automatically generated on:
			Monday 27 December 2004 - 16:15:25
		</div>
		<br>
		<div class="Copyright">
			SQL Server Centric .NET Code Generator<br>
			Olymars Library v 1.0.1697.21165<br>
		</div>
	</body>
</html>
